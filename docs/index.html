<!DOCTYPE html>
<html>
  <head>
    <title>R과 DB 어딘가에 결국 자료형을 다루어야 한다</title>
    <meta charset="utf-8">
    <meta name="author" content="박찬엽" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/font-awesome-animation/font-awesome-animation-emi.css" rel="stylesheet" />
    <script src="libs/fontawesome/js/fontawesome-all.min.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-47822682-14', 'auto');
      ga('send', 'pageview');
    </script>
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




class: center, middle, title-slide, inverse

## R과 DB 어딘가에 결국 자료형을 다루어야 한다

### &lt;https://mrchypark.github.io/datetimeR&gt;

#### [[pdf버전]](https://github.com/mrchypark/datetimeR/blob/master/docs/datetimeR.pdf) [[문의하기]](http://pf.kakao.com/_RXANd) [[의견 및 오류 신고]](https://github.com/mrchypark/datetimeR/issues/new)
#### [스타누르기](https://github.com/mrchypark/datetimeR)는 컨텐츠 제작자를 춤추게 합니다.

### 박찬엽

### 2018년 10월 19일
---
class: inverse
## 목차

.pull-left[
1. 발표자 소개

2. 모던 R 프로그래밍 with [tidyverse](https://www.tidyverse.org/)
    - tidy 란
    - tidyverse의 중심: [dplyr](https://dplyr.tidyverse.org/)
    - 파이프 연산자 `%&gt;%` [magrittr](https://magrittr.tidyverse.org/)
    
3. [DBI](https://dbi.r-dbi.org/)와 함께 *dplyr*로 데이터 다루기
    - [RPostgres](https://github.com/r-dbi/RPostgres) vs [RPostgreSQL](https://github.com/tomoakin/RPostgreSQL)
    
4. 날짜 자료형을 다루는 [lubridate](https://github.com/tidyverse/lubridate)
    - timezone 문제
]

--

.pull-right[
&lt;br&gt;
&lt;br&gt;

<span>&lt;i class="fas  fa-leaf faa-bounce animated "&gt;&lt;/i&gt;</span>  협업을 위해      

  - [writexl](https://github.com/ropensci/writexl) vs [openxlsx](https://github.com/awalker89/openxlsx)
  - [googledrive](https://googledrive.tidyverse.org/)
  - [sendgridr](https://mrchypark.github.io/sendgridr/)
]

---

class: center, middle, title-slide, inverse


## [발표자 소개][intro]

---

class: center, middle, title-slide, inverse

## 모던 R 프로그래밍이란

## tidy data + universe 

[![](https://github.com/tidyverse/tidyverse/raw/master/man/figures/logo.png)][1]

---
class: inverse
## [tidyverse][1] 패키지는

.pull-left[
1. RStudio가 개발, 관리하는 패키지    
1. 공식 문서가 매우 잘 되어 있음    
1. 사용자층이 두터워 영어로 검색하면 많은 질답을 찾을 수 있음    
1. 커뮤니티 설명글도 매우 많음    
1. 6개의 핵심 패키지 포함 23가지 패키지로 이루어진 메타 패키지    
1. tidy data 라는 사상과 파이프 연산자로 대동단결    
1. 사상에 영감을 받아 맞춰서 제작하는 개인 패키지가 많음(ex&gt; [tidyquant](https://github.com/business-science/tidyquant), [tidytext](https://github.com/juliasilge/tidytext) 등)
]
.pull-right[

```r
if (!requireNamespace("tidyverse")){
  install.packages("tidyverse")}
library(tidyverse)
```

&lt;img src = "https://lsru.github.io/tv_course/img/01_tidyverse_data_science.png" width=100%&gt;
]
---
class: inverse
## tidy data 란

1. [Hadley Wickham](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html)  2. [고감자님의 블로그](http://freesearch.pe.kr/archives/3942)  3. [헬로우데이터과학](http://www.hellodatascience.com/?p=287)


1.1 Each variable forms a column.    
1.2 각 변수는 개별의 열(column)으로 존재한다.    
1.3 각 열에는 개별 속성이 들어간다.    

2.1 Each observation forms a row.    
2.2 각 관측치는 행(row)를 구성한다.    
2.3 각 행에는 개별 관찰 항목이 들어간다.    

3.1 Each type of observational unit forms a table.    
3.2 각 테이블은 단 하나의 관측기준에 의해서 조직된 데이터를 저장한다.    
3.3 각 테이블에는 단일 유형의 데이터가 들어간다.    

.footnote[
  \* 출처 : [금융데이터 분석을 위한 R 입문][2]
]
---
class: inverse
## tidy data 란

![](http://garrettgman.github.io/images/tidy-1.png)

.footnote[
  \* 출처 : [Garrett Grolemund의 Data Science with R 블로그](http://garrettgman.github.io/tidying/)
]

---
class: inverse
## long form vs wide form

.pull-left[
### long form

1. 컴퓨터가 계산하기 좋은 모양
1. tidy data의 요건을 충족
1. tidyverse의 패키지 대부분의 입력 형태
]
.pull-right[
### wide form

1. 사람이 눈으로 보기 좋은 모양
1. 2개 변수에 대한 값만 확인 가능
1. dashboard 형이라고도 하며 조인 등 연산이 어려움
]

---

class: center, middle, title-slide, inverse

## tidyverse의 중심: [dplyr](https://dplyr.tidyverse.org/)

![](https://github.com/tidyverse/dplyr/raw/master/man/figures/logo.png)

---
class: inverse

## 데이터를 다루는 주요 7가지 동작

.pull-left[
[dplyr](https://dplyr.tidyverse.org/)은 데이터를 다루는 주요 7가지 동작 자체를 함수로 가지고 추가적인 helper 함수를 함께 제공

1. 열 방향: 선택 - select()
1. 열 방향: 계산 - mutate()
1. 행 방향: 조건 - filter()
1. 행 방향: 추가 - bind_rows()
1. 행 방향: 정렬 - arrange()
1. 그룹 계산 - group_by() + summarise()
1. 열 결합 - left_join()
]
.pull-right[
![](https://raw.githubusercontent.com/mrchypark/dabrp_classnote3/master/docs/img/dplyr.png) 
]

---
![](https://raw.githubusercontent.com/mrchypark/dabrp_classnote3/master/docs/img/dplyr.png)

---

class: center, middle, title-slide, inverse

## 함수를 연결하는 파이프 연산자(%&gt;%)

![](https://raw.githubusercontent.com/mrchypark/dabrp_classnote3/master/docs/img/pipes.png)

---

class: inverse
## 파이프 연산자(%&gt;%)

함수를 중첩해서 사용할 일이 점점 빈번해 짐

```{}
plot(diff(log(sample(rnorm(10000,mean=10,sd=1),size=100,replace=FALSE))),col="red",type="l")
```

--
class: inverse
### %&gt;%를 사용하면 

.pull-left[

1. 생각의 순서대로 함수를 작성할 수 있음
1. 중간 변수 저장을 할 필요가 없음
1. 순서가 읽이 용이하여 기억하기 좋음
]
.pull-right[
```{}
rnorm(10000,mean=10,sd=1) %&gt;%
  sample(size=100,replace=FALSE) %&gt;%
  log %&gt;%
  diff %&gt;%
  plot(col="red",type="l")
```
]
---
class: inverse

## 파이프 연산자(%&gt;%)

flights 데이터에 파이프 연산자 사용예 1


```r
flights %&gt;%
  group_by(year,month,day) %&gt;%
  summarise(delay=mean(dep_delay, na.rm = TRUE))
```

```
## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.5 
##  2  2013     1     2 13.9 
##  3  2013     1     3 11.0 
##  4  2013     1     4  8.95
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.55
##  9  2013     1     9  2.28
## 10  2013     1    10  2.84
## # ... with 355 more rows
```
---
class: inverse
## 파이프 연산자(%&gt;%)

group_by()는 filter()와도 함께 사용할 수 있음


```r
popular_dests &lt;- flights %&gt;% 
  group_by(dest) %&gt;% 
  filter(n() &gt; 365)
popular_dests
```

```
## # A tibble: 332,577 x 19
## # Groups:   dest [77]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 332,567 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;
```

---
class: inverse
## 파이프 연산자(%&gt;%)

사용할 데이터부터 순서대로 함수를 작성할 수 있는 장점


```r
popular_dests %&gt;% 
  filter(arr_delay &gt; 0) %&gt;% 
  mutate(prop_delay = arr_delay / sum(arr_delay)) %&gt;% 
  select(year:day, dest, arr_delay, prop_delay)
```

```
## # A tibble: 131,106 x 6
## # Groups:   dest [77]
##     year month   day dest  arr_delay prop_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1  2013     1     1 IAH          11  0.000111 
##  2  2013     1     1 IAH          20  0.000201 
##  3  2013     1     1 MIA          33  0.000235 
##  4  2013     1     1 ORD          12  0.0000424
##  5  2013     1     1 FLL          19  0.0000938
##  6  2013     1     1 ORD           8  0.0000283
##  7  2013     1     1 LAX           7  0.0000344
##  8  2013     1     1 DFW          31  0.000282 
##  9  2013     1     1 ATL          12  0.0000400
## 10  2013     1     1 DTW          16  0.000116 
## # ... with 131,096 more rows
```

---

class: center, middle, title-slide, inverse

## DBI

## Database with R

![](https://avatars2.githubusercontent.com/u/5695665?s=200&amp;v=4)

---
class: inverse

## .blue[redshift]

.pull-left[
&lt;img src=https://data.world/api/datadotworld-apps/dataset/redshift/file/raw/logo.png width=80%&gt;
]

---
class: inverse

## .blue[redshift] is almost Postgresql

.pull-right[
&lt;br&gt;
&lt;img src = https://upload.wikimedia.org/wikipedia/commons/thumb/2/29/Postgresql_elephant.svg/1200px-Postgresql_elephant.svg.png width=60%&gt;
]
---
class: center, middle, title-slide, inverse

## R <span>&lt;i class="fas  fa-heart faa-bounce animated " style=" color:red;"&gt;&lt;/i&gt;</span> Database

---
class: inverse

.pull-left[
## driver list .small[(DBI supported)]

- SQLite
- MySQL(+MariaDB)
- bigquery
- Oracle
- ...
]
.pull-right[
## +noDBI .small[supported]

- MongoDB
- Redis
- CouchDB
- Elasticsearch 
- etcd 
- ...

]

--
## + sergeant .small[(with Apache Drill)]

- HBase
- MapR-DB
- HDFS
- MapR-FS
- Amazon S3
- ...

---
class: center, middle, title-slide, inverse

## JDBC &amp; ODBC

---
class: center, middle, title-slide, inverse

## DBI

![](https://d33wubrfki0l68.cloudfront.net/738885c8f54f3ab6118545469c28cd6635fcd656/96e0d/homepage/interact.png)

---
class: inverse

## driver package

### RPostgreSQL

---
class: inverse

## driver package

### RPostgres

---
class: inverse

## redshift에 연결해보자

```r
# install.packages("remotes")
remotes::install_github("r-dbi/RPostgres")
library(DBI)
con &lt;- dbConnect(Postgres(),
                 user = user,
                 password = pw,
                 host = host,
                 port = port,
                 dbname = "dbname")
```
---
class: inverse

## 데이터 소스로서 DBI

DBI 패키지가 연결하는 database의 연결정보를 바탕으로 dplyr 문법을 사용할 수 있습니다. 그렇게 하기 위해서는 dbplyr 패키지가 필요합니다.


```r
if (!requireNamespace("dbplyr")) install.packages("dbplyr")
library(dbplyr)
```

---
class: inverse
# R 데이터를 DB 테이블로 만들기 copy_to()

copy_to()는 DBI의 dbWriteTable()과 같은 기능을 수행. dplyr 패키지에 속한 copy_to()는 성능 개선을 통해 dbWriteTable() 보다 빠른 속도를 제공함


```r
library(RSQLite)
library(nycflights13)

conn &lt;- dbConnect(SQLite(),
                  ":memory:")

copy_to(conn
        , flights
        , name = 'flights')
dbListTables(conn)
```

```
## [1] "flights"      "sqlite_stat1" "sqlite_stat4"
```

---
class: inverse
## 테이블의 연결정보를 R 객체에 저장 - tbl()

dbplyr과 DBI, dplyr로 데이터베이스의 테이블을 dplyr 문법으로 다루기 위해서는 DBI 패키지에서 conn 객체와 같이 테이블의 연결정보를 담고 있는 R 객체가 필요. tbl()는 DB내 테이블 연결정보를 R 객체로 만드는 함수


```r
tb_flights &lt;- tbl(conn, "flights")
tb_flights
```

```
## # Source:   table&lt;flights&gt; [?? x 19]
## # Database: sqlite 3.22.0 [:memory:]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dbl&gt;
```

---
class: inverse
### collect()

collect()는 DB에 전달하는 명령의 최종 결과를 R 객체로 가져오는 역할을 수행합니다.

.pull-left[
```r
tb_flights %&gt;%
  group_by(carrier) %&gt;%
  summarise(count = n())
```
```
# Source:   lazy query [?? x 2]
# Database: sqlite 3.22.0 [:memory:]
   carrier count
   &lt;chr&gt;   &lt;int&gt;
 1 9E      18460
 2 AA      32729
 3 AS        714
 4 B6      54635
 5 DL      48110
 6 EV      54173
 7 F9        685
 8 FL       3260
 9 HA        342
10 MQ      26397
# ... with more rows
```
]

.pull-right[

```r
tb_flights %&gt;%
  group_by(carrier) %&gt;%
  summarise(count = n()) %&gt;%
  collect()
```

```
## # A tibble: 16 x 2
##    carrier count
##    &lt;chr&gt;   &lt;int&gt;
##  1 9E      18460
##  2 AA      32729
##  3 AS        714
##  4 B6      54635
##  5 DL      48110
##  6 EV      54173
##  7 F9        685
##  8 FL       3260
##  9 HA        342
## 10 MQ      26397
## 11 OO         32
## 12 UA      58665
## 13 US      20536
## 14 VX       5162
## 15 WN      12275
## 16 YV        601
```
]
---
class: inverse
### 결과를 테이블로 저장 - compute()

compute()는 collect()와는 달리 연산된 결과를 R 객체로 저장하는 것이 아니라 새로 이름지은 테이블로 DB에 저장하는 동작을 수행

```r
dbListTables(conn)
```
```
[1] "flights"      "sqlite_stat1" "sqlite_stat4"
```
```r
tb_flights %&gt;%
  group_by(tailnum) %&gt;%
  summarise(count=n(),
            mean_distance = mean(distance, na.rm = TRUE),
            total_distance = sum(distance, na.rm = TRUE)) %&gt;%
  filter(!is.na(tailnum)) %&gt;%
  compute(name = 'planes_distance')
```
```
# Source:   table&lt;planes_distance&gt; [?? x 4]
# Database: sqlite 3.22.0 [:memory:]
   tailnum count mean_distance total_distance
   &lt;chr&gt;   &lt;int&gt;         &lt;dbl&gt;          &lt;dbl&gt;
 1 D942DN      4          854.           3418
 2 N0EGMQ    371          676.         250866
 3 N10156    153          758.         115966
 4 N102UW     48          536.          25722
 5 N103US     46          535.          24619
 6 N104UW     47          535.          25157
 7 N10575    289          520.         150194
 8 N105UW     45          525.          23618
 9 N107US     41          529.          21677
10 N108UW     60          534.          32070
# ... with more rows
```
---
class: inverse
### show_query()

show_query()는 dplyr로 구성된 함수의 연결이 query문으로 어떻게 변환되는지를 보여줌

```r
copy_to(conn, planes, name = 'planes', temporary = FALSE)
tbl(conn, 'planes_distance') %&gt;%
  inner_join(tbl(conn, 'planes'), by='tailnum') %&gt;%
  arrange(desc(total_distance)) %&gt;%
  select(total_distance, manufacturer, model) %&gt;%
  show_query()
```
```sql
&lt;SQL&gt;
SELECT `total_distance`, `manufacturer`, `model`
FROM (SELECT *
FROM (SELECT `TBL_LEFT`.`tailnum` AS `tailnum`, `TBL_LEFT`.`count` AS `count`, `TBL_LEFT`.`mean_distance` AS `mean_distance`, `TBL_LEFT`.`total_distance` AS `total_distance`, `TBL_RIGHT`.`year` AS `year`, `TBL_RIGHT`.`type` AS `type`, `TBL_RIGHT`.`manufacturer` AS `manufacturer`, `TBL_RIGHT`.`model` AS `model`, `TBL_RIGHT`.`engines` AS `engines`, `TBL_RIGHT`.`seats` AS `seats`, `TBL_RIGHT`.`speed` AS `speed`, `TBL_RIGHT`.`engine` AS `engine`
  FROM `planes_distance` AS `TBL_LEFT`
  INNER JOIN `planes` AS `TBL_RIGHT`
  ON (`TBL_LEFT`.`tailnum` = `TBL_RIGHT`.`tailnum`)
)
ORDER BY `total_distance` DESC)
```
---
class: inverse

## 역시 패키지는 배신한다 .small[(aka 오해)]

---
class: inverse

## 숫자 자료형이 늘어났다!?

### integer64

---
class: inverse

## numeric

base R의 숫자 자료형

---
class: inverse

## 모던 R 패키지에서는

tibble 내의 dbl, integer, integer64

---

class: center, middle, title-slide, inverse

## .green[lubridate]

## datetime in R

![](https://github.com/tidyverse/lubridate/raw/master/man/figures/logo.png)


---
class: inverse

## timezone

.pull-center[
  .set[
    ![](https://c.tadst.com/gfx/tzmap/map.1538884800.png?1174)  
  ]
]

---
class: center, middle, title-slide, inverse

## 한국은?

--

### Asia/Seoul(KST)

--

### UTC(협정 세계시) + 9시간

---

class: inverse

## Timezones in base R


```r
x &lt;- "2018-01-01 06:00:00"
as.POSIXct(x)
```

```
## [1] "2018-01-01 06:00:00 KST"
```

```r
as.POSIXct(x, tz = "Asia/Seoul")
```

```
## [1] "2018-01-01 06:00:00 KST"
```

```r
Sys.timezone()
```

```
## [1] "Asia/Seoul"
```

```r
Sys.time()
```

```
## [1] "2018-10-09 17:09:57 KST"
```

---

class: inverse

## 우리의 DB는 UTC

데이터 베이스에서 가져온 날짜를 as.Date

```
코드와 결과 예시
```

---
class: center, middle, title-slide, inverse

## 헷갈리기 딱 좋음

---

class: inverse

## lubridate


```r
library(lubridate)
x &lt;- "2018-01-01 12:00:00"

as_datetime(x)
```

```
## [1] "2018-01-01 12:00:00 UTC"
```

```r
ymd_hms(x)
```

```
## [1] "2018-01-01 12:00:00 UTC"
```

---

class: inverse

## timezone을 바꿔봅시다.


```r
as_datetime(x)
```

```
## [1] "2018-01-01 12:00:00 UTC"
```

```r
as_datetime(x, tz = "Asia/Seoul")
```

```
## [1] "2018-01-01 12:00:00 KST"
```
```r
as_datetime(x, tz = "KST")
```
```
##  Error in C_force_tz(time, tz = tzone, roll) : 
##    CCTZ: Unrecognized output timezone: "KST"
```

---
class: center, middle, title-slide, inverse

## 협업을 위한 패키지들

---
class: inverse

## 엑셀로 저장하기

```r
library(openxlsx)
library(writexl)
```

---
class: inverse

## 구글 드라이브

```r
library(googledrive)
```

---
class: inverse

## 메일 보내기

```r
library(sendgridr)
```

---
class: inverse

## 느낀 점

- 역시 삽질
- ...

[1]: https://github.com/tidyverse/tidyverse
[2]: https://mrchypark.github.io/kisa_finR
[tidytextmining]: https://www.tidytextmining.com/
[tidytext]: https://juliasilge.github.io/tidytext/
[intro]: https://mrchypark.github.io/self-introduce/#1
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
